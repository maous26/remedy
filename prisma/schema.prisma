generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  subtitle    String
  description String   @db.Text
  origin      String
  history     String   @db.Text
  benefits    String[]
  usages      Json     // { method: string, instructions: string }[]
  precautions String   @db.Text
  price       Float
  weight      String
  stock       Int      @default(100)
  images      String[]
  categories  String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  packItems   PackItem[]
  orderItems  OrderItem[]
}

model Pack {
  id              String   @id @default(cuid())
  name            String
  slug            String   @unique
  subtitle        String
  description     String   @db.Text
  targetProblem   String   @db.Text
  synergy         String   @db.Text
  protocol        String   @db.Text
  duration        String
  price           Float
  originalPrice   Float    // Prix si achat séparé
  images          String[]
  categories      String[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  items           PackItem[]
  orderItems      OrderItem[]
}

model PackItem {
  id        String  @id @default(cuid())
  packId    String
  productId String
  quantity  String  // ex: "50g", "100g"

  pack      Pack    @relation(fields: [packId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Order {
  id                String      @id @default(cuid())
  orderNumber       String      @unique
  status            OrderStatus @default(PENDING)
  email             String
  shippingAddress   Json        // { name, address, city, postalCode, country }
  subtotal          Float
  shippingCost      Float
  total             Float
  currency          String      @default("EUR")
  stripeSessionId   String?     @unique
  stripePaymentId   String?
  notes             String?     @db.Text
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  items             OrderItem[]
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  productId String?
  packId    String?
  name      String
  price     Float
  quantity  Int

  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  pack      Pack?    @relation(fields: [packId], references: [id], onDelete: SetNull)
}

enum OrderStatus {
  PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}
